'use strict';

var axios = require('axios');
var dateFns = require('date-fns');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var axios__default = /*#__PURE__*/_interopDefaultLegacy(axios);

const config = {
    BASE_URL: 'https://api.mapbox.com',
    TELEMETRY_URL: 'https://events.mapbox.com',
    SOURCE_URL: 'mapbox://mapbox-ads.bq09b9qc',
    LAYER_SOURCE_ID: 'promoted-pins-8s73mu',
    ACCESS_TOKEN: '',
    MOBILE_MAX_WIDTH: 768,
    DEBUG: false,
};

class Event {
    type;
    data;
    constructor(type, data = {}) {
        this.type = type;
        this.data = data;
    }
}

const axiosInstance = (options = {}) => {
    const { baseURL, isBlob } = options;
    return axios__default["default"].create({
        baseURL: baseURL || config.BASE_URL,
        headers: {
            'Content-Type': 'application/json',
        },
        timeout: 1000 * 30,
        responseType: isBlob ? 'blob' : 'json',
    });
};

const randomString = (length = 8) => (Math.random().toString(length).substring(2));

const ACTIONS = {
    CALL: 'Call',
    NAVIGATION: 'Navigation',
    DETAIL: 'Detail',
    BANNER: 'BannerDetail',
};

let lastSessionTime = new Date();
let sessionIdentifier = randomString();
const verifySession = async () => {
    if (!lastSessionTime || dateFns.differenceInSeconds(new Date(), lastSessionTime) > 60) {
        lastSessionTime = new Date();
        sessionIdentifier = randomString();
        await sessionStart();
    }
};
function sendEvent(params) {
    if (config.DEBUG) {
        return;
    }
    return new Promise((resolve, reject) => {
        const url = `/events/v2?access_token=${config.ACCESS_TOKEN}`;
        return axiosInstance({
            baseURL: config.TELEMETRY_URL,
            isBlob: true
        }).post(url, params).then((res) => {
            resolve(res.data);
        }).catch((error) => {
            console.error(error);
            reject(error);
        });
    });
}
async function sessionStart() {
    const params = {
        sessionIdentifier,
        event: 'adMetrics.sessionStart',
        bucket: 'undefined',
        created: new Date().toISOString(),
    };
    return sendEvent([params]);
}
async function sendSelection(adid, zoomLevel) {
    const params = {
        sessionIdentifier,
        event: 'adMetrics.select',
        adid,
        zoomLevel,
        created: new Date().toISOString(),
    };
    await verifySession();
    return sendEvent([params]);
}
async function sendDeselection(adid) {
    const params = {
        sessionIdentifier,
        event: 'adMetrics.deselect',
        adid,
        created: new Date().toISOString(),
    };
    await verifySession();
    return sendEvent([params]);
}
async function sendVisibilities(features) {
    const params = features.map(({ adid, visibleStartTime, visibleEndTime }) => ({
        sessionIdentifier,
        event: 'adMetrics.visible',
        adid,
        visibleStartTime,
        visibleEndTime,
        created: new Date().toISOString(),
    }));
    await verifySession();
    return sendEvent(params);
}
async function sendAction(adid, action) {
    const params = {
        sessionIdentifier,
        event: 'adMetrics.callToAction',
        adid,
        action,
        created: new Date().toISOString(),
    };
    await verifySession();
    return sendEvent([params]);
}

const EVENT_TYPES = {
    LOAD: 'load',
    MOVE: 'move',
    CLICK_PIN: 'click_pin',
    CLICK_CARD: 'click_card',
    SHOW_CARD: 'show_card',
    UPDATE_CARD: 'update_card',
    CLOSE_CARD: 'close_card',
    CLICK_SIDE_CARD: 'click_side_card',
    SHOW_SIDE_CARD: 'show_side_card',
    UPDATE_SIDE_CARD: 'update_side_card',
    OPEN_SIDE_CARD: 'open_side_card',
    HIDE_SIDE_CARD: 'hide_side_card',
    CLOSE_SIDE_CARD: 'close_side_card',
    CLICK_POPUP: 'click_popup',
    SHOW_POPUP: 'show_popup',
    CLOSE_POPUP: 'close_popup',
};
const CLICK_TYPES = {
    CARD: 'card',
    TOGGLE: 'toggle',
    BANNER: 'banner',
    PHONE: 'phone',
    DIRECTIONS: 'directions',
    DETAIL: 'detail',
};
const TELEMETRY_ACTIONS = {
    [CLICK_TYPES.BANNER]: ACTIONS.BANNER,
    [CLICK_TYPES.PHONE]: ACTIONS.CALL,
    [CLICK_TYPES.DIRECTIONS]: ACTIONS.NAVIGATION,
    [CLICK_TYPES.DETAIL]: ACTIONS.DETAIL,
};

const camelCase = (object) => {
    const updatedObject = {};
    for (const key in object) {
        if (object.hasOwnProperty(key)) {
            updatedObject[key.replace(/(\_\w)/g, updatedKey => (updatedKey[1].toUpperCase()))] = object[key];
        }
    }
    return updatedObject;
};
const formatProperties = (properties) => camelCase(properties);

exports.EVENT_TYPES = EVENT_TYPES;
exports.Event = Event;
exports.TELEMETRY_ACTIONS = TELEMETRY_ACTIONS;
exports.config = config;
exports.formatProperties = formatProperties;
exports.sendAction = sendAction;
exports.sendDeselection = sendDeselection;
exports.sendSelection = sendSelection;
exports.sendVisibilities = sendVisibilities;
exports.sessionStart = sessionStart;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZS01NDMyMzUwOS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL2NvbmZpZy50cyIsIi4uLy4uL3NyYy9jb3JlL2V2ZW50LnRzIiwiLi4vLi4vc3JjL2FwaXMvYXhpb3MudHMiLCIuLi8uLi9zcmMvdXRpbHMvc3RyaW5nLnRzIiwiLi4vLi4vc3JjL2FwaXMvdGVsZW1ldHJ5LmhlbHBlci50cyIsIi4uLy4uL3NyYy9hcGlzL3RlbGVtZXRyeS50cyIsIi4uLy4uL3NyYy9jb3JlL2hlbHBlcnMudHMiLCIuLi8uLi9zcmMvdXRpbHMvZmVhdHVyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBCQVNFX1VSTDogJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20nLFxuICBURUxFTUVUUllfVVJMOiAnaHR0cHM6Ly9ldmVudHMubWFwYm94LmNvbScsXG4gIFNPVVJDRV9VUkw6ICdtYXBib3g6Ly9tYXBib3gtYWRzLmJxMDliOXFjJyxcbiAgTEFZRVJfU09VUkNFX0lEOiAncHJvbW90ZWQtcGlucy04czczbXUnLFxuICBBQ0NFU1NfVE9LRU46ICcnLFxuICBNT0JJTEVfTUFYX1dJRFRIOiA3NjgsXG4gIERFQlVHOiBmYWxzZSxcbn07XG4iLCJleHBvcnQgY2xhc3MgRXZlbnQgaW1wbGVtZW50cyBNYXBib3hQcm9tb3RlZC5FdmVudCB7XG4gIHB1YmxpYyB0eXBlOiBNYXBib3hQcm9tb3RlZC5FdmVudFR5cGVzO1xuICBwdWJsaWMgZGF0YTogT2JqZWN0O1xuXG4gIGNvbnN0cnVjdG9yKHR5cGU6IE1hcGJveFByb21vdGVkLkV2ZW50VHlwZXMsIGRhdGE6IE9iamVjdCA9IHt9KSB7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICB9XG59XG4iLCJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAndXRpbHMvY29uZmlnJztcblxudHlwZSBPUFRJT05TID0ge1xuICBiYXNlVVJMPzogc3RyaW5nO1xuICBpc0Jsb2I/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGNvbnN0IGF4aW9zSW5zdGFuY2UgPSAob3B0aW9uczogT1BUSU9OUyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgYmFzZVVSTCwgaXNCbG9iIH0gPSBvcHRpb25zO1xuICByZXR1cm4gYXhpb3MuY3JlYXRlKHtcbiAgICBiYXNlVVJMOiBiYXNlVVJMIHx8IGNvbmZpZy5CQVNFX1VSTCxcbiAgICBoZWFkZXJzOiB7XG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIH0sXG4gICAgdGltZW91dDogMTAwMCAqIDMwLFxuICAgIHJlc3BvbnNlVHlwZTogaXNCbG9iID8gJ2Jsb2InIDogJ2pzb24nLFxuICB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGF4aW9zSW5zdGFuY2U7XG4iLCJleHBvcnQgY29uc3QgcmFuZG9tU3RyaW5nID0gKGxlbmd0aDogbnVtYmVyID0gOCk6IHN0cmluZyA9PiAoXG4gIE1hdGgucmFuZG9tKCkudG9TdHJpbmcobGVuZ3RoKS5zdWJzdHJpbmcoMilcbik7XG4iLCJleHBvcnQgY29uc3QgQUNUSU9OUyA9IHtcbiAgQ0FMTDogJ0NhbGwnLFxuICBOQVZJR0FUSU9OOiAnTmF2aWdhdGlvbicsXG4gIERFVEFJTDogJ0RldGFpbCcsXG4gIEJBTk5FUjogJ0Jhbm5lckRldGFpbCcsXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgRkVFREJBQ0tfVFlQRVMgPSB7XG4gIEFUVFJJQlVUSU9OOiAnYXR0cmlidXRpb24nLFxuICBRVU9URTogJ3F1b3RlJyxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBGRUVEQkFDS19BQ1RJT05TID0ge1xuICBRVU9URTogJ0Fkc1F1b3RlJyxcbiAgREVUQUlMOiAnQWRzQXR0cmlidXRpb25EZXRhaWwnLFxuICBGRUVEQkFDSzogJ0ZlZWRiYWNrJyxcbn0gYXMgY29uc3Q7XG4iLCJpbXBvcnQgYXhpb3NJbnN0YW5jZSBmcm9tICcuL2F4aW9zJztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJ3V0aWxzL2NvbmZpZyc7XG5pbXBvcnQgeyBkaWZmZXJlbmNlSW5TZWNvbmRzIH0gZnJvbSAnZGF0ZS1mbnMnO1xuaW1wb3J0IHsgcmFuZG9tU3RyaW5nIH0gZnJvbSAndXRpbHMvc3RyaW5nJztcbmltcG9ydCB7IEFDVElPTlMsIEZFRURCQUNLX0FDVElPTlMsIEZFRURCQUNLX1RZUEVTIH0gZnJvbSAnLi90ZWxlbWV0cnkuaGVscGVyJztcblxuZXhwb3J0IHtcbiAgQUNUSU9OUyxcbiAgRkVFREJBQ0tfQUNUSU9OUyxcbiAgRkVFREJBQ0tfVFlQRVNcbn07XG5cbmxldCBsYXN0U2Vzc2lvblRpbWUgPSBuZXcgRGF0ZSgpO1xubGV0IHNlc3Npb25JZGVudGlmaWVyID0gcmFuZG9tU3RyaW5nKCk7XG5cbmV4cG9ydCBjb25zdCB2ZXJpZnlTZXNzaW9uID0gYXN5bmMgKCkgPT4ge1xuICBpZiAoIWxhc3RTZXNzaW9uVGltZSB8fCBkaWZmZXJlbmNlSW5TZWNvbmRzKG5ldyBEYXRlKCksIGxhc3RTZXNzaW9uVGltZSkgPiA2MCkge1xuICAgIGxhc3RTZXNzaW9uVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgc2Vzc2lvbklkZW50aWZpZXIgPSByYW5kb21TdHJpbmcoKTtcbiAgICBhd2FpdCBzZXNzaW9uU3RhcnQoKTtcbiAgfVxufTtcblxuZnVuY3Rpb24gc2VuZEV2ZW50KHBhcmFtczogT2JqZWN0KTogUHJvbWlzZTxPYmplY3Q+IHwgdW5kZWZpbmVkIHtcbiAgaWYgKGNvbmZpZy5ERUJVRykgeyByZXR1cm47IH1cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCB1cmwgPSBgL2V2ZW50cy92Mj9hY2Nlc3NfdG9rZW49JHtjb25maWcuQUNDRVNTX1RPS0VOfWA7XG4gICAgcmV0dXJuIGF4aW9zSW5zdGFuY2Uoe1xuICAgICAgYmFzZVVSTDogY29uZmlnLlRFTEVNRVRSWV9VUkwsXG4gICAgICBpc0Jsb2I6IHRydWVcbiAgICB9KS5wb3N0KHVybCwgcGFyYW1zKS50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgICAgcmVzb2x2ZShyZXMuZGF0YSk7XG4gICAgfSkuY2F0Y2goKGVycm9yOiBFcnJvcikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICByZWplY3QoZXJyb3IpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXNzaW9uU3RhcnQoKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHNlc3Npb25JZGVudGlmaWVyLFxuICAgIGV2ZW50OiAnYWRNZXRyaWNzLnNlc3Npb25TdGFydCcsXG4gICAgYnVja2V0OiAndW5kZWZpbmVkJyxcbiAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gIH07XG4gIHJldHVybiBzZW5kRXZlbnQoW3BhcmFtc10pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFNlbGVjdGlvbihhZGlkOiBzdHJpbmcsIHpvb21MZXZlbDogbnVtYmVyKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHNlc3Npb25JZGVudGlmaWVyLFxuICAgIGV2ZW50OiAnYWRNZXRyaWNzLnNlbGVjdCcsXG4gICAgYWRpZCxcbiAgICB6b29tTGV2ZWwsXG4gICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9O1xuICBhd2FpdCB2ZXJpZnlTZXNzaW9uKCk7XG4gIHJldHVybiBzZW5kRXZlbnQoW3BhcmFtc10pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZERlc2VsZWN0aW9uKGFkaWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICBzZXNzaW9uSWRlbnRpZmllcixcbiAgICBldmVudDogJ2FkTWV0cmljcy5kZXNlbGVjdCcsXG4gICAgYWRpZCxcbiAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gIH07XG4gIGF3YWl0IHZlcmlmeVNlc3Npb24oKTtcbiAgcmV0dXJuIHNlbmRFdmVudChbcGFyYW1zXSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kVmlzaWJpbGl0aWVzKFxuICBmZWF0dXJlczogVGVsZW1ldHJ5QVBJLkZlYXR1cmVbXVxuKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcGFyYW1zID0gZmVhdHVyZXMubWFwKCh7XG4gICAgYWRpZCxcbiAgICB2aXNpYmxlU3RhcnRUaW1lLFxuICAgIHZpc2libGVFbmRUaW1lXG4gIH0pID0+ICh7XG4gICAgc2Vzc2lvbklkZW50aWZpZXIsXG4gICAgZXZlbnQ6ICdhZE1ldHJpY3MudmlzaWJsZScsXG4gICAgYWRpZCxcbiAgICB2aXNpYmxlU3RhcnRUaW1lLFxuICAgIHZpc2libGVFbmRUaW1lLFxuICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgfSkpO1xuICBhd2FpdCB2ZXJpZnlTZXNzaW9uKCk7XG4gIHJldHVybiBzZW5kRXZlbnQocGFyYW1zKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRBY3Rpb24oXG4gIGFkaWQ6IHN0cmluZyxcbiAgYWN0aW9uOiBUZWxlbWV0cnlBUEkuQWN0aW9uc1xuKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHNlc3Npb25JZGVudGlmaWVyLFxuICAgIGV2ZW50OiAnYWRNZXRyaWNzLmNhbGxUb0FjdGlvbicsXG4gICAgYWRpZCxcbiAgICBhY3Rpb24sXG4gICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9O1xuICBhd2FpdCB2ZXJpZnlTZXNzaW9uKCk7XG4gIHJldHVybiBzZW5kRXZlbnQoW3BhcmFtc10pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZEZlZWRiYWNrKFxuICBhZGlkOiBzdHJpbmcsXG4gIGFjdGlvbjogVGVsZW1ldHJ5QVBJLkZlZWRiYWNrQWN0aW9ucyxcbiAgdHlwZTogVGVsZW1ldHJ5QVBJLkZlZWRiYWNrVHlwZXNcbik6IFByb21pc2U8YW55PiB7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICBzZXNzaW9uSWRlbnRpZmllcixcbiAgICBldmVudDogJ2FkTWV0cmljcy5mZWVkYmFjaycsXG4gICAgYWRpZCxcbiAgICBhY3Rpb24sXG4gICAgdHlwZSxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9O1xuICBhd2FpdCB2ZXJpZnlTZXNzaW9uKCk7XG4gIHJldHVybiBzZW5kRXZlbnQoW3BhcmFtc10pO1xufVxuIiwiaW1wb3J0ICogYXMgdGVsZW1ldHJ5QVBJcyBmcm9tICdhcGlzL3RlbGVtZXRyeSc7XG5cbmV4cG9ydCBjb25zdCBFVkVOVF9UWVBFUyA9IHtcbiAgTE9BRDogJ2xvYWQnLFxuICBNT1ZFOiAnbW92ZScsXG4gIENMSUNLX1BJTjogJ2NsaWNrX3BpbicsXG4gIFxuICBDTElDS19DQVJEOiAnY2xpY2tfY2FyZCcsXG4gIFNIT1dfQ0FSRDogJ3Nob3dfY2FyZCcsXG4gIFVQREFURV9DQVJEOiAndXBkYXRlX2NhcmQnLFxuICBDTE9TRV9DQVJEOiAnY2xvc2VfY2FyZCcsXG4gIFxuICBDTElDS19TSURFX0NBUkQ6ICdjbGlja19zaWRlX2NhcmQnLFxuICBTSE9XX1NJREVfQ0FSRDogJ3Nob3dfc2lkZV9jYXJkJyxcbiAgVVBEQVRFX1NJREVfQ0FSRDogJ3VwZGF0ZV9zaWRlX2NhcmQnLFxuICBPUEVOX1NJREVfQ0FSRDogJ29wZW5fc2lkZV9jYXJkJyxcbiAgSElERV9TSURFX0NBUkQ6ICdoaWRlX3NpZGVfY2FyZCcsXG4gIENMT1NFX1NJREVfQ0FSRDogJ2Nsb3NlX3NpZGVfY2FyZCcsXG5cbiAgQ0xJQ0tfUE9QVVA6ICdjbGlja19wb3B1cCcsXG4gIFNIT1dfUE9QVVA6ICdzaG93X3BvcHVwJyxcbiAgQ0xPU0VfUE9QVVA6ICdjbG9zZV9wb3B1cCcsXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgQ0xJQ0tfVFlQRVMgPSB7XG4gIENBUkQ6ICdjYXJkJyxcbiAgVE9HR0xFOiAndG9nZ2xlJyxcbiAgQkFOTkVSOiAnYmFubmVyJyxcbiAgUEhPTkU6ICdwaG9uZScsXG4gIERJUkVDVElPTlM6ICdkaXJlY3Rpb25zJyxcbiAgREVUQUlMOiAnZGV0YWlsJyxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBURUxFTUVUUllfQUNUSU9OUzogeyBba2V5OiBzdHJpbmddOiBUZWxlbWV0cnlBUEkuQWN0aW9ucyB9ID0ge1xuICBbQ0xJQ0tfVFlQRVMuQkFOTkVSXTogdGVsZW1ldHJ5QVBJcy5BQ1RJT05TLkJBTk5FUixcbiAgW0NMSUNLX1RZUEVTLlBIT05FXTogdGVsZW1ldHJ5QVBJcy5BQ1RJT05TLkNBTEwsXG4gIFtDTElDS19UWVBFUy5ESVJFQ1RJT05TXTogdGVsZW1ldHJ5QVBJcy5BQ1RJT05TLk5BVklHQVRJT04sXG4gIFtDTElDS19UWVBFUy5ERVRBSUxdOiB0ZWxlbWV0cnlBUElzLkFDVElPTlMuREVUQUlMLFxufSBhcyBjb25zdDtcbiIsImltcG9ydCB7IGlzU2F0dXJkYXksIGlzU3VuZGF5IH0gZnJvbSAnZGF0ZS1mbnMnO1xuXG50eXBlIERpY3QgPSB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xuXG5jb25zdCBjYW1lbENhc2UgPSAob2JqZWN0OiBEaWN0KTogRGljdCA9PiB7XG4gIGNvbnN0IHVwZGF0ZWRPYmplY3Q6IERpY3QgPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb2JqZWN0KSB7XG4gICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICB1cGRhdGVkT2JqZWN0W2tleS5yZXBsYWNlKC8oXFxfXFx3KS9nLCB1cGRhdGVkS2V5ID0+IChcbiAgICAgICAgdXBkYXRlZEtleVsxXS50b1VwcGVyQ2FzZSgpXG4gICAgICApKV0gPSBvYmplY3Rba2V5XTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVwZGF0ZWRPYmplY3Q7XG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0UHJvcGVydGllcyA9IChwcm9wZXJ0aWVzOiBhbnkpOiBGZWF0dXJlLlByb3BlcnRpZXMgPT4gKFxuICBjYW1lbENhc2UocHJvcGVydGllcykgYXMgRmVhdHVyZS5Qcm9wZXJ0aWVzXG4pO1xuXG5leHBvcnQgY29uc3QgZ2V0T3BlbkNsb3NlTGFiZWwgPSAocHJvcGVydGllczogRmVhdHVyZS5Qcm9wZXJ0aWVzKTogc3RyaW5nID0+IHtcbiAgY29uc3QgeyBzYXRPcGVuLCBzYXRDbG9zZSwgc3VuT3Blbiwgc3VuQ2xvc2UsIHdlZWtPcGVuLCB3ZWVrQ2xvc2UgfSA9IHByb3BlcnRpZXM7XG4gIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgbGV0IG9wZW4gPSAnJztcbiAgbGV0IGNsb3NlID0gJyc7XG4gIGlmIChpc1NhdHVyZGF5KHRvZGF5KSAmJiBzYXRPcGVuICYmIHNhdENsb3NlKSB7XG4gICAgb3BlbiA9IHNhdE9wZW47XG4gICAgY2xvc2UgPSBzYXRDbG9zZTtcbiAgfSBlbHNlIGlmIChpc1N1bmRheSh0b2RheSkgJiYgc3VuT3BlbiAmJiBzdW5DbG9zZSkge1xuICAgIG9wZW4gPSBzdW5PcGVuO1xuICAgIGNsb3NlID0gc3VuQ2xvc2U7XG4gIH0gZWxzZSBpZiAod2Vla09wZW4gJiYgd2Vla0Nsb3NlKSB7XG4gICAgb3BlbiA9IHdlZWtPcGVuO1xuICAgIGNsb3NlID0gd2Vla0Nsb3NlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAnJztcbiAgfVxuICBjb25zdCBvcGVuTWF0Y2ggPSBgJHtvcGVufWAubWF0Y2goLyhcXGR7MSwyfSkoXFxkezJ9KSQvKTtcbiAgY29uc3Qgb3BlbkhvdXIgPSBvcGVuTWF0Y2ggJiYgb3Blbk1hdGNoLmxlbmd0aCA+PSAzID8gb3Blbk1hdGNoWzFdIDogJyc7XG4gIGNvbnN0IG9wZW5NaW4gPSBvcGVuTWF0Y2ggJiYgb3Blbk1hdGNoLmxlbmd0aCA+PSAzID8gb3Blbk1hdGNoWzJdIDogJyc7XG4gIGNvbnN0IGNsb3NlTWF0Y2ggPSBgJHtjbG9zZX1gLm1hdGNoKC8oXFxkezEsMn0pKFxcZHsyfSkkLyk7XG4gIGNvbnN0IGNsb3NlSG91ciA9IGNsb3NlTWF0Y2ggJiYgY2xvc2VNYXRjaC5sZW5ndGggPj0gMyA/IGNsb3NlTWF0Y2hbMV0gOiAnJztcbiAgY29uc3QgY2xvc2VNaW4gPSBjbG9zZU1hdGNoICYmIGNsb3NlTWF0Y2gubGVuZ3RoID49IDMgPyBjbG9zZU1hdGNoWzJdIDogJyc7XG4gIGNvbnN0IG9wZW5MYW5iZWwgPSBgJHtvcGVuSG91cn06JHtvcGVuTWlufWA7XG4gIGNvbnN0IGNsb3NlTGFuYmVsID0gYCR7Y2xvc2VIb3VyfToke2Nsb3NlTWlufWA7XG4gIHJldHVybiBgJHtvcGVuTGFuYmVsfSAtICR7Y2xvc2VMYW5iZWx9YDtcbn07XG4iXSwibmFtZXMiOlsiYXhpb3MiLCJkaWZmZXJlbmNlSW5TZWNvbmRzIiwidGVsZW1ldHJ5QVBJcy5BQ1RJT05TIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7TUFBYSxNQUFNLEdBQUc7SUFDcEIsUUFBUSxFQUFFLHdCQUF3QjtJQUNsQyxhQUFhLEVBQUUsMkJBQTJCO0lBQzFDLFVBQVUsRUFBRSw4QkFBOEI7SUFDMUMsZUFBZSxFQUFFLHNCQUFzQjtJQUN2QyxZQUFZLEVBQUUsRUFBRTtJQUNoQixnQkFBZ0IsRUFBRSxHQUFHO0lBQ3JCLEtBQUssRUFBRSxLQUFLOzs7TUNQRCxLQUFLO0lBQ1QsSUFBSSxDQUE0QjtJQUNoQyxJQUFJLENBQVM7SUFFcEIsWUFBWSxJQUErQixFQUFFLE9BQWUsRUFBRTtRQUM1RCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztLQUNsQjs7O0FDQ0ksTUFBTSxhQUFhLEdBQUcsQ0FBQyxVQUFtQixFQUFFO0lBQ2pELE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLEdB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
